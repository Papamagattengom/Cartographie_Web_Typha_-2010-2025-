<!doctype html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="initial-scale=1,user-scalable=no,maximum-scale=1,width=device-width">
        <meta name="mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-capable" content="yes">
        <link rel="stylesheet" href="css/leaflet.css">
        <link rel="stylesheet" href="css/L.Control.Layers.Tree.css">
        <link rel="stylesheet" href="css/qgis2web.css">
        <link rel="stylesheet" href="css/fontawesome-all.min.css">
        <link rel="stylesheet" href="css/leaflet.photon.css">
        <link rel="stylesheet" href="css/leaflet-measure.css">
        <style>
        html, body, #map {
            width: 100%;
            height: 100%;
            padding: 0;
            margin: 0;
        }
        </style>
        <title>Cartographie Web du Typha 2010-2025</title>
    </head>
    <body>
        <div id="map">
        </div>
        <script src="js/qgis2web_expressions.js"></script>
        <script src="js/leaflet.js"></script>
        <script src="js/L.Control.Layers.Tree.min.js"></script>
        <script src="js/leaflet.rotatedMarker.js"></script>
        <script src="js/leaflet.pattern.js"></script>
        <script src="js/leaflet-hash.js"></script>
        <script src="js/Autolinker.min.js"></script>
        <script src="js/rbush.min.js"></script>
        <script src="js/labelgun.min.js"></script>
        <script src="js/labels.js"></script>
        <script src="js/leaflet.photon.js"></script>
        <script src="js/leaflet-measure.js"></script>
        <script src="data/Dpartement_SaintLouis_Dagana_1.js"></script>
        <script src="data/Dcoupage_zone_d_intervention_Dlgation_Dagana_2.js"></script>
        <script src="data/Hydrologie_Dagana_3.js"></script>
        <script src="data/EvolutionduTypha_4.js"></script>
        <script>
        var map = L.map('map', {
            zoomControl:false, maxZoom:28, minZoom:1
        }).fitBounds([[15.668745064047693,-16.730901566077694],[16.67657304016563,-14.654121942367917]]);
        var hash = new L.Hash(map);
        map.attributionControl.setPrefix('<a href="https://github.com/tomchadwin/qgis2web" target="_blank">qgis2web</a> &middot; <a href="https://leafletjs.com" title="A JS library for interactive maps">Leaflet</a> &middot; <a href="https://qgis.org">QGIS</a>');
        var autolinker = new Autolinker({truncate: {length: 30, location: 'smart'}});
        // remove popup's row if "visible-with-data"
        function removeEmptyRowsFromPopupContent(content, feature) {
         var tempDiv = document.createElement('div');
         tempDiv.innerHTML = content;
         var rows = tempDiv.querySelectorAll('tr');
         for (var i = 0; i < rows.length; i++) {
             var td = rows[i].querySelector('td.visible-with-data');
             var key = td ? td.id : '';
             if (td && td.classList.contains('visible-with-data') && feature.properties[key] == null) {
                 rows[i].parentNode.removeChild(rows[i]);
             }
         }
         return tempDiv.innerHTML;
        }
        // add class to format popup if it contains media
		function addClassToPopupIfMedia(content, popup) {
			var tempDiv = document.createElement('div');
			tempDiv.innerHTML = content;
			if (tempDiv.querySelector('td img')) {
				popup._contentNode.classList.add('media');
					// Delay to force the redraw
					setTimeout(function() {
						popup.update();
					}, 10);
			} else {
				popup._contentNode.classList.remove('media');
			}
		}
        var title = new L.Control({'position':'topleft'});
        title.onAdd = function (map) {
            this._div = L.DomUtil.create('div', 'info');
            this.update();
            return this._div;
        };
        title.update = function () {
            this._div.innerHTML = '<h2>Cartographie Web du Typha 2010-2025</h2>';
        };
        title.addTo(map);
        var abstract = new L.Control({'position':'topleft'});
        abstract.onAdd = function (map) {
            this._div = L.DomUtil.create('div',
            'leaflet-control abstract');
            this._div.id = 'abstract'

                abstract.show();
                return this._div;
            };
            abstract.show = function () {
                this._div.classList.remove("abstract");
                this._div.classList.add("abstractUncollapsed");
                this._div.innerHTML = 'Représentation de l\'Evolution du Typha entre 2010 et 2025 par une carte synthese illustrant la variation du plante par reduction et augmentation dans dans les perimetres du reseau hydraulique de la délégation de Dagana';
        };
        abstract.addTo(map);
        var zoomControl = L.control.zoom({
            position: 'topleft'
        }).addTo(map);
        var measureControl = new L.Control.Measure({
            position: 'topleft',
            primaryLengthUnit: 'meters',
            secondaryLengthUnit: 'kilometers',
            primaryAreaUnit: 'sqmeters',
            secondaryAreaUnit: 'hectares'
        });
        measureControl.addTo(map);
        document.getElementsByClassName('leaflet-control-measure-toggle')[0].innerHTML = '';
        document.getElementsByClassName('leaflet-control-measure-toggle')[0].className += ' fas fa-ruler';
        var bounds_group = new L.featureGroup([]);
        function setBounds() {
        }
        map.createPane('pane_OSMStandard_0');
        map.getPane('pane_OSMStandard_0').style.zIndex = 400;
        var layer_OSMStandard_0 = L.tileLayer('http://tile.openstreetmap.org/{z}/{x}/{y}.png', {
            pane: 'pane_OSMStandard_0',
            opacity: 1.0,
            attribution: '<a href="https://www.openstreetmap.org/copyright">© OpenStreetMap contributors, CC-BY-SA</a>',
            minZoom: 1,
            maxZoom: 28,
            minNativeZoom: 0,
            maxNativeZoom: 19
        });
        layer_OSMStandard_0;
        map.addLayer(layer_OSMStandard_0);
        function pop_Dpartement_SaintLouis_Dagana_1(feature, layer) {
            var popupContent = '<table>\
                    <tr>\
                        <th scope="row">NOM_Departement</th>\
                        <td>' + (feature.properties['NAME_2'] !== null ? autolinker.link(String(feature.properties['NAME_2']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <th scope="row">Superfitie</th>\
                        <td>' + (feature.properties['Superfitie'] !== null ? autolinker.link(String(feature.properties['Superfitie']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                </table>';
            var content = removeEmptyRowsFromPopupContent(popupContent, feature);
			layer.on('popupopen', function(e) {
				addClassToPopupIfMedia(content, e.popup);
			});
			layer.bindPopup(content, { maxHeight: 400 });
        }

        function style_Dpartement_SaintLouis_Dagana_1_0() {
            return {
                pane: 'pane_Dpartement_SaintLouis_Dagana_1',
                interactive: true,
            }
        }
        map.createPane('pane_Dpartement_SaintLouis_Dagana_1');
        map.getPane('pane_Dpartement_SaintLouis_Dagana_1').style.zIndex = 401;
        map.getPane('pane_Dpartement_SaintLouis_Dagana_1').style['mix-blend-mode'] = 'normal';
        var layer_Dpartement_SaintLouis_Dagana_1 = new L.geoJson(json_Dpartement_SaintLouis_Dagana_1, {
            attribution: '',
            interactive: true,
            dataVar: 'json_Dpartement_SaintLouis_Dagana_1',
            layerName: 'layer_Dpartement_SaintLouis_Dagana_1',
            pane: 'pane_Dpartement_SaintLouis_Dagana_1',
            onEachFeature: pop_Dpartement_SaintLouis_Dagana_1,
            style: style_Dpartement_SaintLouis_Dagana_1_0,
        });
        bounds_group.addLayer(layer_Dpartement_SaintLouis_Dagana_1);
        map.addLayer(layer_Dpartement_SaintLouis_Dagana_1);
        function pop_Dcoupage_zone_d_intervention_Dlgation_Dagana_2(feature, layer) {
            var popupContent = '<table>\
                    <tr>\
                        <th scope="row">Nom_secteu</th>\
                        <td>' + (feature.properties['Nom_secteu'] !== null ? autolinker.link(String(feature.properties['Nom_secteu']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                </table>';
            var content = removeEmptyRowsFromPopupContent(popupContent, feature);
			layer.on('popupopen', function(e) {
				addClassToPopupIfMedia(content, e.popup);
			});
			layer.bindPopup(content, { maxHeight: 400 });
        }

        function style_Dcoupage_zone_d_intervention_Dlgation_Dagana_2_0() {
            return {
                pane: 'pane_Dcoupage_zone_d_intervention_Dlgation_Dagana_2',
                opacity: 1,
                color: 'rgba(214,20,20,1.0)',
                dashArray: '',
                lineCap: 'butt',
                lineJoin: 'miter',
                weight: 2.0, 
                fillOpacity: 0,
                interactive: true,
            }
        }
        map.createPane('pane_Dcoupage_zone_d_intervention_Dlgation_Dagana_2');
        map.getPane('pane_Dcoupage_zone_d_intervention_Dlgation_Dagana_2').style.zIndex = 402;
        map.getPane('pane_Dcoupage_zone_d_intervention_Dlgation_Dagana_2').style['mix-blend-mode'] = 'normal';
        var layer_Dcoupage_zone_d_intervention_Dlgation_Dagana_2 = new L.geoJson(json_Dcoupage_zone_d_intervention_Dlgation_Dagana_2, {
            attribution: '',
            interactive: true,
            dataVar: 'json_Dcoupage_zone_d_intervention_Dlgation_Dagana_2',
            layerName: 'layer_Dcoupage_zone_d_intervention_Dlgation_Dagana_2',
            pane: 'pane_Dcoupage_zone_d_intervention_Dlgation_Dagana_2',
            onEachFeature: pop_Dcoupage_zone_d_intervention_Dlgation_Dagana_2,
            style: style_Dcoupage_zone_d_intervention_Dlgation_Dagana_2_0,
        });
        bounds_group.addLayer(layer_Dcoupage_zone_d_intervention_Dlgation_Dagana_2);
        map.addLayer(layer_Dcoupage_zone_d_intervention_Dlgation_Dagana_2);
        function pop_Hydrologie_Dagana_3(feature, layer) {
            var popupContent = '<table>\
                    <tr>\
                        <th scope="row">Nom</th>\
                        <td>' + (feature.properties['Nom'] !== null ? autolinker.link(String(feature.properties['Nom']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <th scope="row">Superficie</th>\
                        <td>' + (feature.properties['Superficie'] !== null ? autolinker.link(String(feature.properties['Superficie']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                </table>';
            var content = removeEmptyRowsFromPopupContent(popupContent, feature);
			layer.on('popupopen', function(e) {
				addClassToPopupIfMedia(content, e.popup);
			});
			layer.bindPopup(content, { maxHeight: 400 });
        }

        function style_Hydrologie_Dagana_3_0() {
            return {
                pane: 'pane_Hydrologie_Dagana_3',
                stroke: false, 
                fill: true,
                fillOpacity: 1,
                fillColor: 'rgba(25,59,215,0.7215686274509804)',
                interactive: true,
            }
        }
        map.createPane('pane_Hydrologie_Dagana_3');
        map.getPane('pane_Hydrologie_Dagana_3').style.zIndex = 403;
        map.getPane('pane_Hydrologie_Dagana_3').style['mix-blend-mode'] = 'normal';
        var layer_Hydrologie_Dagana_3 = new L.geoJson(json_Hydrologie_Dagana_3, {
            attribution: '',
            interactive: true,
            dataVar: 'json_Hydrologie_Dagana_3',
            layerName: 'layer_Hydrologie_Dagana_3',
            pane: 'pane_Hydrologie_Dagana_3',
            onEachFeature: pop_Hydrologie_Dagana_3,
            style: style_Hydrologie_Dagana_3_0,
        });
        bounds_group.addLayer(layer_Hydrologie_Dagana_3);
        map.addLayer(layer_Hydrologie_Dagana_3);
        function pop_EvolutionduTypha_4(feature, layer) {
            var popupContent = '<table>\
                    <tr>\
                        <th scope="row">Nom</th>\
                        <td>' + (feature.properties['Nom'] !== null ? autolinker.link(String(feature.properties['Nom']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <th scope="row">Evolution du TYPHA (2010-2025)</th>\
                        <td>' + (feature.properties['DELTA'] !== null ? autolinker.link(String(feature.properties['DELTA']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <th scope="row">Evolution</th>\
                        <td>' + (feature.properties['Evolution'] !== null ? autolinker.link(String(feature.properties['Evolution']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                </table>';
            var content = removeEmptyRowsFromPopupContent(popupContent, feature);
			layer.on('popupopen', function(e) {
				addClassToPopupIfMedia(content, e.popup);
			});
			layer.bindPopup(content, { maxHeight: 400 });
        }

        function style_EvolutionduTypha_4_0(feature) {
            switch(String(feature.properties['Evolution'])) {
                case 'Légere Augmentation':
                    return {
                pane: 'pane_EvolutionduTypha_4',
                opacity: 1,
                color: 'rgba(178,223,138,1.0)',
                dashArray: '',
                lineCap: 'butt',
                lineJoin: 'miter',
                weight: 8.0, 
                fill: true,
                fillOpacity: 1,
                fillColor: 'rgba(69,227,77,1.0)',
                interactive: true,
            }
                    break;
                case 'Légere Diminution':
                    return {
                pane: 'pane_EvolutionduTypha_4',
                opacity: 1,
                color: 'rgba(251,154,153,1.0)',
                dashArray: '',
                lineCap: 'butt',
                lineJoin: 'miter',
                weight: 11.0, 
                fill: true,
                fillOpacity: 1,
                fillColor: 'rgba(255,213,213,1.0)',
                interactive: true,
            }
                    break;
                case 'Moyen Augmentation':
                    return {
                pane: 'pane_EvolutionduTypha_4',
                opacity: 1,
                color: 'rgba(94,255,89,1.0)',
                dashArray: '',
                lineCap: 'square',
                lineJoin: 'bevel',
                weight: 11.0,
                fillOpacity: 0,
                interactive: true,
            }
                    break;
                case 'Moyen Diminution':
                    return {
                pane: 'pane_EvolutionduTypha_4',
                opacity: 1,
                color: 'rgba(209,81,79,1.0)',
                dashArray: '',
                lineCap: 'butt',
                lineJoin: 'miter',
                weight: 11.0, 
                fill: true,
                fillOpacity: 1,
                fillColor: 'rgba(255,128,128,1.0)',
                interactive: true,
            }
                    break;
                case 'Trés Faible Diminution':
                    return {
                pane: 'pane_EvolutionduTypha_4',
                opacity: 1,
                color: 'rgba(227,26,28,1.0)',
                dashArray: '',
                lineCap: 'butt',
                lineJoin: 'miter',
                weight: 15.0, 
                fill: true,
                fillOpacity: 1,
                fillColor: 'rgba(255,85,85,1.0)',
                interactive: true,
            }
                    break;
                case 'Trés Forte Augmentation':
                    return {
                pane: 'pane_EvolutionduTypha_4',
                opacity: 1,
                color: 'rgba(51,160,44,1.0)',
                dashArray: '',
                lineCap: 'butt',
                lineJoin: 'miter',
                weight: 11.0, 
                fill: true,
                fillOpacity: 1,
                fillColor: 'rgba(51,160,44,1.0)',
                interactive: true,
            }
                    break;
            }
        }
        map.createPane('pane_EvolutionduTypha_4');
        map.getPane('pane_EvolutionduTypha_4').style.zIndex = 404;
        map.getPane('pane_EvolutionduTypha_4').style['mix-blend-mode'] = 'normal';
        var layer_EvolutionduTypha_4 = new L.geoJson(json_EvolutionduTypha_4, {
            attribution: '',
            interactive: true,
            dataVar: 'json_EvolutionduTypha_4',
            layerName: 'layer_EvolutionduTypha_4',
            pane: 'pane_EvolutionduTypha_4',
            onEachFeature: pop_EvolutionduTypha_4,
            style: style_EvolutionduTypha_4_0,
        });
        bounds_group.addLayer(layer_EvolutionduTypha_4);
        map.addLayer(layer_EvolutionduTypha_4);
        const url = {"Nominatim": "https://nominatim.openstreetmap.org/search?format=geojson&addressdetails=1&",
        "BAN": "https://api-adresse.data.gouv.fr/search/?"}
        var photonControl = L.control.photon({
            url: url["Nominatim"],
            feedbackLabel: '',
            position: 'topleft',
            includePosition: true,
            initial: true,
            // resultsHandler: myHandler,
        }).addTo(map);
        photonControl._container.childNodes[0].style.borderRadius="10px"
        // Create a variable to store the geoJSON data
        var x = null;
        // Create a variable to store the marker
        var marker = null;
        // Add an event listener to the Photon control to create a marker from the returned geoJSON data
        var z = null;
        photonControl.on('selected', function(e) {
            console.log(photonControl.search.resultsContainer);
            if (x != null) {
                map.removeLayer(obj3.marker);
                map.removeLayer(x);
            }
            obj2.gcd = e.choice;
            x = L.geoJSON(obj2.gcd).addTo(map);
            var label = typeof obj2.gcd.properties.label === 'undefined' ? obj2.gcd.properties.display_name : obj2.gcd.properties.label;
            obj3.marker = L.marker(x.getLayers()[0].getLatLng()).bindPopup(label).addTo(map);
            map.setView(x.getLayers()[0].getLatLng(), 17);
            z = typeof e.choice.properties.label === 'undefined'? e.choice.properties.display_name : e.choice.properties.label;
            console.log(e);
            e.target.input.value = z;
        });
        var search = document.getElementsByClassName("leaflet-photon leaflet-control")[0];
        search.classList.add("leaflet-control-search")
        search.style.display = "flex";
        search.style.backgroundColor="rgba(255,255,255,0.5)" 

        // Créer le nouvel élément bouton
        var button = document.createElement("div");
        button.id = "gcd-button-control";
        button.className = "gcd-gl-btn fa fa-search search-button";

        // Ajouter le bouton à l'élément parent
        search.insertBefore(button, search.firstChild);
        last = search.lastChild;
        last.style.display = "none";
        button.addEventListener("click", function (e) {
            if (last.style.display === "none") {
                last.style.display = "block";
            } else {
                last.style.display = "none";
            }
        });
        var overlaysTree = [
            {label: 'Evolution du Typha<br /><table><tr><td style="text-align: center;"><img src="legend/EvolutionduTypha_4_LégereAugmentation0.png" /></td><td>Légere Augmentation</td></tr><tr><td style="text-align: center;"><img src="legend/EvolutionduTypha_4_LégereDiminution1.png" /></td><td>Légere Diminution</td></tr><tr><td style="text-align: center;"><img src="legend/EvolutionduTypha_4_MoyenAugmentation2.png" /></td><td>Moyen Augmentation</td></tr><tr><td style="text-align: center;"><img src="legend/EvolutionduTypha_4_MoyenDiminution3.png" /></td><td>Moyen Diminution</td></tr><tr><td style="text-align: center;"><img src="legend/EvolutionduTypha_4_TrésFaibleDiminution4.png" /></td><td>Trés Faible Diminution</td></tr><tr><td style="text-align: center;"><img src="legend/EvolutionduTypha_4_TrésForteAugmentation5.png" /></td><td>Trés Forte Augmentation</td></tr></table>', layer: layer_EvolutionduTypha_4},
            {label: '<img src="legend/Hydrologie_Dagana_3.png" /> Hydrologie_Dagana', layer: layer_Hydrologie_Dagana_3},
            {label: '<img src="legend/Dcoupage_zone_d_intervention_Dlgation_Dagana_2.png" /> Découpage_zone_d_intervention_Délégation_Dagana', layer: layer_Dcoupage_zone_d_intervention_Dlgation_Dagana_2},
            {label: '<img src="legend/Dpartement_SaintLouis_Dagana_1.png" /> Département_Saint-Louis_Dagana', layer: layer_Dpartement_SaintLouis_Dagana_1},
            {label: "OSM Standard", layer: layer_OSMStandard_0},]
        var lay = L.control.layers.tree(null, overlaysTree,{
            //namedToggle: true,
            //selectorBack: false,
            //closedSymbol: '&#8862; &#x1f5c0;',
            //openedSymbol: '&#8863; &#x1f5c1;',
            //collapseAll: 'Collapse all',
            //expandAll: 'Expand all',
            collapsed: true,
        });
        lay.addTo(map);
        setBounds();
        </script>
    </body>
</html>
